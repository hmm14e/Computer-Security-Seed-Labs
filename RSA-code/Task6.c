/* Task6: Verifiying a Facebook Signature */
#include <stdio.h>
#include <openssl/bn.h>

#define NBITS 256

void printBNhex(char *msg, BIGNUM * a)
{
	/* Use BN_bn2hex(a) for hex string*/
	char * number_str = BN_bn2hex(a);
	printf("%s %s\n", msg, number_str);
	OPENSSL_free(number_str);
}

int main ()
{
	//Declare variables
	BN_CTX *ctx = BN_CTX_new();
	BIGNUM *e = BN_new();
	BIGNUM *n = BN_new();
	BIGNUM *S = BN_new();
	BIGNUM *m = BN_new();

	//Initialize variables with given values
	BN_hex2bn(&n, "B6E02FC22406C86D045FD7EF0A6406B27D22266516AE42409BCEDC9F9F76073EC330558719B94F940E5A941F5556B4C2022AAFD098EE0B40D7C4D03B72C8149EEF90B111A9AED2C8B8433AD90B0BD5D595F540AFC81DED4D9C5F57B786506899F58ADAD2C7051FA897C9DCA4B182842DC6ADA59CC71982A6850F5E44582A378FFD35F10B0827325AF5BB8B9EA4BD51D027E2DD3B4233A30528C4BB28CC9AAC2B230D78C67BE65E71B74A3E08FB81B71616A19D23124DE5D79208AC75A49CBACD17B21E4435657F532539D11C0A9A631B199274680A37C2C25248CB395AA2B6E15DC1DDA020B821A293266F144A2141C7ED6D9BF2482FF303F5A26892532F5EE3");
	BN_hex2bn(&e, "010001");
	BN_hex2bn(&S, "6bb4bb1643f884575e51562cfbe49d191703b274f0dc95286ef4336bc38b6c45d9807caa5660a315bc622895f3a229c2d3a160b6629d23b48820434264dfeb6ecb4cf7ee0dc17aa8eb8e5854ef8f521ba653ef19622ee6d34188558d43114020bd917fee6f9887be61ecd41d32c61aac11b456b62264b5ec832462367dd0b6175cee6a6f544a90526d02f1014db26cbfc92bf89e91c7e60d272d7b2e7057f8c6d68b205bbd4428337b1832671699c6909840b3f591d662365eb9f4876c7286e8a0d82d4f31e83ca182dc4adabb2820c94d9c990d1da2e3c3e6fced50986be10c5a9a6f56e3725ce93d2646f1ed0dd2128a1d4fbee4907517d1b1763a4672e9c7");	 
	/*Decrypt using Public Key
	/m = S^e mod n*/
	BN_mod_exp(m, S, e, n, ctx);
	printBNhex("message hex = ", m);


	return 0;
}
